class CCFEF extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{inputTelTextArea:"textarea.ccfef_country_code_data_js",intlInputSpan:".ccfef-editor-intl-input",submitButton:"div.elementor-field-type-submit button"}}}getDefaultElements(){const e=this.getSettings("selectors");return{$textArea:this.$element.find(e.inputTelTextArea),$intlSpanElement:this.$element.find(e.intlInputSpan),$submitButton:this.$element.find(e.submitButton)}}bindEvents(){this.telId=new Array,this.includeCountries={},this.excludeCountries={},this.defaultCountry={},this.iti={},this.getIntlUserData(),this.appendCountryCodeHandler(),this.addCountryCodeInputHandler(),this.removeInputTelSpanEle(),this.intlInputValidation()}appendCountryCodeHandler(){this.telId.forEach(e=>{this.addCountryCodeIconHandler(e.formId,e.fieldId,e.customId)})}addCountryCodeIconHandler(e,t,n){const i=CCFEFCustomData.pluginDir+"assets/intl-tel-input/js/utils.min.js",o=jQuery(`.elementor-widget.elementor-widget-form[data-id="${e}"] .elementor-field-type-tel.elementor-field-group input[type="tel"]#${n}`)[0];if(void 0!==o){let n=[],l=[],r="in";const s=["in","us","gb","ru","fr","de","br","cn","jp","it"],a=`${e}${t}`;if(this.includeCountries.hasOwnProperty(a)&&this.includeCountries[a].length>0&&(r=this.includeCountries[a][0],n=this.includeCountries[a].map(e=>e)),this.excludeCountries.hasOwnProperty(a)&&this.excludeCountries[a].length>0){let e=s.filter(e=>!this.excludeCountries[a].includes(e));r=e[0],l=this.excludeCountries[a].map(e=>e)}this.defaultCountry[a]&&""!==this.defaultCountry[a]&&(r=this.defaultCountry[a]);const d=window.intlTelInput(o,{initialCountry:r,utilsScript:i,formatOnDisplay:!1,formatAsYouType:!0,autoFormat:!1,containerClass:"cfefp-intl-container",useFullscreenPopup:!1,onlyCountries:n,excludeCountries:l,customPlaceholder:function(e,t){let n=e;"in"===t.iso2&&(n=e.replace(/^0+/,""));const i=`+${t.dialCode} ${n}`;return i.replace(/\s/g,"")}});o.removeAttribute("pattern"),this.iti[e+t]=d}}addCountryCodeInputHandler(){const e=this.iti;Object.keys(e).forEach(t=>{const n=e[t],i=n.a;let o=n.getSelectedCountryData(),l=`+${o.dialCode}`,r=!1;const s=()=>{r=!1},a=e=>{const t=n.getSelectedCountryData(),i=`+${t.dialCode}`;if("keydown"===e.type||"input"===e.type)r=!0,clearTimeout(s),setTimeout(s,400),o.dialCode!==t.dialCode?o=t:o.dialCode===t.dialCode&&o.iso2!==t.iso2&&n.setCountry(o.iso2);else if("countrychange"===e.type){if(r)return;o=t}this.updateCountryCodeHandler(e.currentTarget,i,l),l=i};i.addEventListener("keydown",a),i.addEventListener("input",a),i.addEventListener("countrychange",a)})}updateCountryCodeHandler(e,t,n){let i=e.value;t&&"+undefined"===t||["","+"].includes(i)||(t!==n&&(i=i.replace(new RegExp(`^\\${n}`),"")),i.startsWith(t)||(i=i.replace(/\+/g,""),e.value=t+i))}removeInputTelSpanEle(){this.$element.find("span.ccfef-editor-intl-input").remove()}getIntlUserData(){const e=this.elements.$intlSpanElement,t=[];e.each((e,n)=>{const i=jQuery(n),o=i.data("include-countries"),l=i.data("exclude-countries"),r=i.data("defaultCountry"),s=i.data("id"),a=i.data("field-id"),d=i.closest(".elementor-element.elementor-widget-form").data("id"),u=`${d}${a}`;if(""!==o){const e=o.split(",");this.includeCountries[u]=e}if(""!==l){const e=l.split(",");this.excludeCountries[u]=e}""!==r&&(this.defaultCountry[u]=r),t.includes(u)||(this.telId.push({formId:d,fieldId:a,customId:s}),t.push(u))})}intlInputValidation(){this.elements.$submitButton.on("click",e=>{const t=this.iti;Object.keys(t).length>0&&Object.keys(t).forEach(n=>{const i=t[n],o=i.a;""!==o.value&&(o.value=o.value.replace(/[^0-9+]/g,""));const l=o.closest(".elementor-field-group"),r=l.querySelector(".cfefp-intl-container");r&&o.offsetHeight&&r.style.setProperty("--cfefp-intl-tel-button-height",`${o.offsetHeight}px`);const s=jQuery(o).parent();s.find("span.elementor-message").remove();const a=CCFEFCustomData.errorMap;let d='<span class="elementor-message elementor-message-danger elementor-help-inline elementor-form-help-inline" role="alert">';if(""!==o.value)if(i.isValidNumber())jQuery(o).closest(".cfefp-intl-container").removeClass("elementor-error");else{const t=i.getValidationError();void 0!==t&&a[t]&&(d+=a[t]+"</span>",jQuery(o).closest(".cfefp-intl-container").addClass("elementor-error"),jQuery(o).after(d),e.preventDefault())}})})}}jQuery(window).on("elementor/frontend/init",()=>{const e=e=>{elementorFrontend.elementsHandler.addHandler(CCFEF,{$element:e})};elementorFrontend.hooks.addAction("frontend/element_ready/form.default",e)});